<!--/assets/js/lead-form.js--><script>(function(){async function mountLeadForms(){const hosts=document.querySelectorAll('[data-leadform-placeholder]');if(!hosts.length)return;const html=await fetch('/components/lead-form.html').then(r=>r.text());hosts.forEach(host=>{host.innerHTML=html;const form=host.querySelector('[data-leadform]');if(!form)return;const interes=host.getAttribute('data-interes')|| '';const title=host.getAttribute('data-title')|| '';const source=host.getAttribute('data-source')||(location.pathname+location.hash);const canal=host.getAttribute('data-canal')|| '';const msgPh=host.getAttribute('data-msg')|| '';if(title)form.querySelector('[data-leadform-title]').textContent=title;if(interes){const sel=form.querySelector('select[name="interes"]');if(sel)sel.value=interes;}form.querySelector('input[name="source_page"]').value=source;if(canal.toLowerCase()==='show'){const block=form.querySelector('[data-leadform-canal]');if(block)block.style.display='block';}if(msgPh){const ta=form.querySelector('textarea[name="mensaje"]');if(ta)ta.setAttribute('placeholder',msgPh);}});}async function onSubmit(e){const form=e.target.closest('form.qv-form[data-leadform]');if(!form)return;e.preventDefault();const fd=new FormData(form);if(!fd.get('brand'))fd.set('brand','qivodigital');if(!fd.get('source_page'))fd.set('source_page',location.pathname+location.hash);const qs=new URLSearchParams(location.search);['utm_source','utm_medium','utm_campaign'].forEach(k=>{if(qs.get(k)&& !fd.get(k))fd.set(k,qs.get(k));});try{const res=await fetch(form.getAttribute('action')|| '/api/leads.php',{method:'POST',body:fd});const json=await res.json();if(typeof toast !=='undefined'){json.ok ? toast.ok('✅ Correcto','Recibimos tu solicitud. Te contactaremos en menos de 24 h.'):toast.error('❌ Error','No pudimos registrar tu solicitud. Intenta nuevamente.');}else{alert(json.ok ? '✅ Recibimos tu solicitud. Te contactaremos en menos de 24 h.':'❌ No pudimos registrar tu solicitud. Intenta nuevamente.');}if(json.ok)form.reset();}catch(err){if(typeof toast !=='undefined'){toast.warn('⚠️ Red','Error de red. Verifica tu conexión e intenta otra vez.');}else{alert('⚠️ Error de red. Verifica tu conexión e intenta otra vez.');}}}document.addEventListener('DOMContentLoaded',mountLeadForms);document.addEventListener('submit',onSubmit);})();</script>